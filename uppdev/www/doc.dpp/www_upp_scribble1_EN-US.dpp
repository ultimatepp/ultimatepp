ITEM("www", "upp", "scribble1", "EN-US") EXTERNAL
TXT("[%EN-US3 $$0,0#00000000000000000000000000000000:Default]")
TXT("[l321;t246;%EN-USC@5;1 $$1,1#20902679421464641399138805415013:co")
TXT("de]")
TXT("[{_}%EN-US ")
TXT("[s0;b100;a25;Q*R6 Scribble, step 1&]")
TXT("[s0;2 In the first step we shall use a quick and simple approach")
TXT(" ")
TXT("to create a rudimentary working application. Our goal is to crea")
TXT("te ")
TXT("a basic program for freehand sketching with the mouse.&]")
TXT("[s0;2 &]")
TXT("[s0;2 ")
TXT("@@PNG:2860&1372")
TXT("‰ĞÎÇŠš€Š€€€ÉÈ ÄÒ€€‚Ë€€€×ˆ‚€€Š€Û¦”©€€‚äÉÄÁÔø×œíİÍ·œÅ¤ı‡àšŸ¬")
TXT("Ë¤€Œ†ü‚ÅÑ€‘ÈÙØá‰")
TXT("«¾ƒ·Ùä™…Ô ŞŒ—ÙÉÚÕæ„¿¤±µ—ŞæÇÖä‘…ì”›¢Ïíˆ‚Ñö²èóÜ¾ıçæÎÁ—\377÷Õ×½Ï")
TXT("¤ÎÏåŞªûãªª\377İİİ³")
TXT("ÏøìÓß¤€€¼¸ï½û—Ò¼Ê¯ßøÛÜ¥ğ€ªñïŞ½\377”Ò¥îÁ£‡ÁŸä­Œ€Ğ•Ãïä®€€Ğ¡òËÃ‡¿úñ¿")
TXT("Úûş‹´È‹ÑÁòÊ§\377Ùœ")
TXT("ÏóŒÅÉâÊ‹ïÁòÊ«·¿İãÉó—§ï°ò–øËçõÏÛŒ™–÷®êê«æªê†Õ¾·Ø™ç–õÃòîÅŸİ°¼¶ú—–")
TXT("êõóšîÙÔÓ»å³¯İ«¨‡")
TXT("’ÕªíŸ²×ÑÑÏ¬ìÕÔ¿Õ·Ü¹¨«ÅúÜù÷·¢÷ÊÍíÕÔ¥Ûó«¨ÛÛñÈ•ñêôİ·¶Ü½ùŠºò¥º ¨")
TXT("ü«•ç ¾ñÜìïê¯¢îø€")
TXT("ïİŠº©„«­ËøàÊµëÑ×Šıº¼çÑÏŸ—ÏşáàÊµ´¬ö‘Şı‹¿§ôËÆ°€€øÁ—®şŠ€ĞŒ¿¿ûáÕİŸü")
TXT("¯ëÖ­¿şøï¯ç\377Ã¿ıú")
TXT("¥€ÏéŞµ´ß­ÂøòøÁ¿ü“ùÚ›û½–€îˆ±ãõ™¿ú›õ¿öüãŞ—ÕÛ°¼şÑ°±½ŒãÅ\377¸°ªçüÏ£ß")
TXT("÷¦”ùùİáŸ\377øÙÏÓÊ")
TXT("¿Ï¾òŞğß³ıöç©¥çîí¼Ÿò¹€ĞˆÑë·ß»ï\377äñó¬‰ãòİµ·ºÑçˆà¾ó¬ÓÊİì÷“Ó¥Óßşç")
TXT("ïıáÃ¿üá­¼‹¿şë\377øå")
TXT("æÊé»¿øçù²ƒ€ãë¢Éî°…¬\377åİ†Ï„ñíã‡×®«½‘Î²ÅÚíç ¢‹—×¾\377ûæÊŒíí®şŸàÒçÅ‚À")
TXT("ˆ­¶æ‚­ã›ïı«®ßüíú")
TXT("ŸÍ×º—ï’¯·ÒÆ„ñåÚ›şİÈøöñƒ”ûÒ•Áæ¸—ÒÛİîÉ‹“áŒı‹üóù¿ôËêÏ¿øû\377\377ğŒáÊéêËï\377")
TXT("ûıû¯¾ôÎíÊ˜ÆŸı¢")
TXT("üÛøæúéé’ş¿şîçİÂ÷ŞŞıÉÊ›\377ùÛğƒşù¯îşÂô§‚€ûê¼ÃÆ\377ğÂ—ìí¸ÚõÉÉ¸¨ò²ôÑ¯Ü")
TXT("¼¾ïÓàÃ·ßçÜ\377ó—Ÿıù")
TXT("ß‹º‡ßüşŒÑÊé©—î¿ïõâí§ß¼İî¿íëß\377¸±´Ï¼üî·•ıãÏŸı¢\377ãß³¯¼÷½×ŞŒË©ı÷ï\377¶")
TXT("‚üò×¿È©Ü½\377ãıçïş")
TXT("ö´¥ôßŸşó¡¹ë‰€œ§Ï¸•»ÎÚØ°Ãú“£Ï¿èºÒÄàç²›¹»Ø®Óòì˜çÆ•¿şóø°à™›İıéí")
TXT("­«¯½½Ëù®·ôåÃ¾”­")
TXT("è€àäı€Æ…ĞçÕº›¯¥¹â\377ùÚÊûÎÃ”ÈİÈØ¤ÅÚúì—±¿ñ«şÚıë€€È‹Ã¹—Ã¹™ÛôìœÃøóÉã")
TXT("µû©¥§ï÷œ£–İÃ”ÒÊ")
TXT("Ã÷ÖîŸ‹€ä\377Ñíì‡\377Œôô©éí¬É…Ÿ†õŞı°ÒšÄË×ú³ ÷ëû§­¶ßªúçı·Ò¢½õÂÊÛßüşÑ¿Ù")
TXT("°ó¸•ã£áÌŸÏşš”óæú")
TXT("œ¾÷ãı¯şüğæ²çß˜ìä‰€çº¬‚¬ä×ì²•ãÂ±ûá¼Èéôşô˜«§Ë†÷àÃú\377ù˜«¿ØÓ•ÒÓ¯Ü¾ù")
TXT("ğûÊ©½ıâÛÕÃçô×«ş÷")
TXT("Áå÷Öş³¦¥Ÿôìõ÷Ö\377³“æ¹×\377Ò¯¿‹ßİ÷ËÙ’€\377š´×²Æ¸›­Ö–›ïšş–ùÓı°Öçãá¸ñ¸€Ìï¼")
TXT("°›õÇ½\377˜×…õ®øİ’™‚")
TXT("º€ŠòëÖ­ÑıŸ\377Ì«†ü¶üª€ÌÉú¯˜“–ù©›®¥¬€¸Ò™±Œ\377\377Õßçª‡À×Û–ç¬ÃÜ˜É˜ÇÎé€€")
TXT("šõçÎÇú¿éŸ®ÎÃ¸")
TXT("û÷î¤Å€•æïıÒØ³Â½—Ëƒô€À††£—³½‚€ø’†€’ÏÂ€€âÉ˜À€À¼‰ƒ€ˆ§á€€ñ¤Œ")
TXT("Ì€ „€Ä‰“°€€ø’†")
TXT("È€ÏÂ€€â€É˜€À¼‰ƒÂ€ˆ§á€€ñ°¤Œ€ „¦€Ä“°€€ø ’†€ÏÂ€‚€âÉ˜€À¼ˆ‰ƒ€ˆ§á€")
TXT("Â€ñ¤Œ€ ™„€Ä“°€")
TXT("€ø’†€Ï‰Â€€âÉ˜€ À¼‰ƒ€ˆ§ˆá€€ñ¤Œ€æ „€Ä“„°€€ø’†€¤ÏÂ€€âÉ€˜€À¼‰ƒ€")
TXT("¡ˆ§á€€ñ¤˜Œ€ „€")
TXT("“Ä“°€€ø’†€ÏÂ€€âÉ˜€À¼‰„ƒ€ˆ§á€€áñ¤Œ€ „Ì€Ä“°€€Àø’†€ÏÂ„€€âÉ˜€À")
TXT("¼‰ƒ€ˆ§á„€€ñ¤Œ€ ")
TXT("³„€Ä“°‚€€ø’†€’ÏÂ€€âÉ˜À€À¼‰ƒ€ˆ§á€€ñ¤ŒÌ€ „€Ä‡»”»€ù¬–Õ‹£ßá¹Ü†")
TXT("Ù”„€ªÔÜÂŸè²Åñùà¥")
TXT("¡£ˆœ€°ÔĞ÷ÂˆÊ–•÷±‰ıó€˜»ÖÊ’Æâ±˜õ÷Ïß½¹œ€ˆ¦æú¯ú‹Ëåò¹Ü¿ùÉƒ€æ®ş„")
TXT("Œ±Ù¼è‰™€ÜĞùÂ°§‡€")
TXT("ì¬ê‡±ıè‚ÅÏÔŒ€š×ñù˜†€…„Œ€Ä«¶áä ¼Å‚€Ô›°á€İ´¾›ºñ¥ÕÏ¶€ãª³äá˜À€öáÚ")
TXT("ˆò˜Ï…‰Ã\377ì€ÙÕöµª")
TXT("¡Ñ‹€¨Á…ã€˜€ÀöÕ¥Œ°ƒ˜€Ğˆª’€†€Ğˆ‰ƒ€áˆ§á€€ñê€É˜¦á€À¹êÉ˜€À¹¤˜Œ€ „€")
TXT("“Ä“°€€ø’†€ÏÂ€€")
TXT("âÉ˜€À¼‰„ƒ€ˆ§á€€áñ¤Œ€ „®Ğ®åò¹ØŒ¬ò—‚ºÉ˜À€À¼‰ƒ€ˆ§á€€ñ¤Œ € Ş½‰Ãü")
TXT("€¥€¨Ç½‰ƒÒ¸€èŒÄÂ")
TXT("”€€âÕ•°œ‘À¡ªÊ˜€€À¡¤Œ€ ˜Şí‰Ã‰’€€¨Áí‰ƒ€¨ÊÁ…‰Ã°†ìÊÅ“ÆĞáÂğÈúÌ€È­Î")
TXT("É„€äÕíÂÂ°Œ€™Õ›")
TXT("æ°’€ùÔÍœ°’€™šÔ°’€”¹ÜÊİ€©ô”¡ã¹Üæ®ˆÙ­ØµªŸĞ‡šúÇ°ºÆ²Û˜Òò¹ì¢Å")
TXT("½òÄáÕ¯ü’Ö‚³ÓÊÂÈú")
TXT("àĞà“½ƒŒ¤‡¡„‘ô¥€°ƒ•¶’Æº‰™øò†€Œª¹„‰‘ÎÎ‹™€Â°–“ÆÇÈŞ€€ñ´›°’ãÁÔæñ±´")
TXT("…æ€Äêºá¤‘½ª£³é‡è")
TXT("¸Ö“÷ÜÚ®‚™åŸå²¯ê”Ğ²ÖÇ°ºÁæş‚À¬‰ã£”€Ñœ¥€¹ã˜²ŒñƒËÀÁ¤ŒÕı° °¹ƒ€æ¬")
TXT("ëÉ¹ÌÎ€€ƒÀÉ˜—²€à")
TXT("–€Î’Ü¬‹™âÎ—€”åığ€ÏÇİ”‰ã§³î™Ğ”‡ôş«™Ã—¿„±«®¦Ê™Ø€ùíé‡×ş÷¨ÇÎËÂØ")
TXT("õœˆ™€¥÷—ˆµïß«Ç")
TXT("…ÎËÂ¸Äßëï‹­²ûöÅù®ˆåº°‚Íù½ÆÅí“ìÛ¼‚Üå–ßã¥×ÊÂ¸Ü™³¼ÀëÑœ¼äÎ—»ßîØ£")
TXT("”æÚÂŠ½¼«†úÏ†…„")
TXT("™µ²ûìºÉ˜°Ç©í†è‘™Ò\377ø¾›\377ÎË\377öªêÃ§Í®¸Û¯°ûø†£ğë²¦¦Üáœ«œóü±ûí°\377Ï•¿Ğ")
TXT("‡²ƒóë‰äîÇ£îŒ×ï")
TXT("ÖëŒ´çûÏÆÊ·âÔúƒĞçå‰ÅâÑßÚ“±»£»åÚ›ÙÈáìŠ¼ì\377É˜Ãˆ”±ïı¹…ŒÕ˜ÁÁºëŸûó")
TXT("öš×Éå¼Ú¢ˆªÎÃÂˆ¶ı")
TXT("ÏÅ²ŸŠœã¿İ·ØÅ¯é–á’¬“áãğ‘Æä»Û¦‚’ÚÆ¼©ûĞ¬ °ä…÷Ÿ¨¬áĞïûÑç½«ñúÂ†¥Ğ")
TXT("Ğ§ áŒâšçº›±ùÌö¹")
TXT("¥Ä‹½ŠĞßí·µÆê”»•‰Ê¬Õƒü‘õ‚°Óó¬ãÏ¦Êê§…ÎîµÍ¾£Û…­Ô±ÏÖµÓ¹ÕÏÂ‚˜ÑøıÇ£­")
TXT("¶ğ¾«é·±‹êÛ‰õóíõ¬")
TXT("Å“°ÆµÆŸª²…ÎÂ»Ï‰Å®Ñªà«ÉúÆèô—ÄëÜèê¢áŒ®¶ûòè§…Ö°¦öòœìÈÕéÚû£Ü›¼«¤Œ©")
TXT("ÄõŸ•ìôÛª³ë½Ç´õí")
TXT("ëÖ›ˆØÂÂ ‚Ä²ÔöÓş…ÀÂÆêû£èïƒµ’°æÃ£ä€²ª›ğ¼‰ãè¢Ç ´ÕãĞ×ö¤·—ãÓ©¼õ¬ãÖê×")
TXT("È¼û«›ËÕ‰Å•ı³³‰ƒ")
TXT("ª’éñ …âÅÍİ¤Œéœü€ÁÒÔ£ìêå‹Ë•å«Èş„¯áâÍ¬ïã×Õ¬ÌÀÂ  ÚüÊ®Íîùæ×¼€ç‹°‰ƒ€")
TXT("¡ˆ§áÌªû¸ªğÉì™ÜÊ¹")
TXT("‹ŠÕÀ ¦şÛË•üŠùÕÈë®Øß×È˜ê¶ÎÂ˜Ú»¢½È®ä‹€ÚøÉ˜äĞ„ËÎ–Ù•–÷ÅğÜ–ä\377Š³— ")
TXT("ò‘æá°©îç‚““ìĞ»ã")
TXT("ô˜™´ü”ÖæÜÚƒ½ì½ßöæ‚´Ã˜†ŒË½Å‘ûšìŠ’æûšÖôã¨¾ÛôÉ˜Ã€‘éÎ¨Ùôõ³ã‹‹Ğ˜§çŒƒ")
TXT("‰ÆÒşÖş‰Æ›ä¦ ãĞÕ")
TXT("û³°òĞ‰ÀĞ–šˆÑœ™ÉáÈÙ’˜ÅùªÚù¥„ã¸ì°­»‰ƒâÙùÄÃÆ²Å¡¤Œ¬™èùêÖ š’ã÷ãîå×š")
TXT("¼‰ƒ‚‰ƒÌÂğ…•õå²ÎÜ")
TXT("Â×§¾’†ÄšÊË¯½—òÒ½şã¦ôªÃ…“ì° Œİö ±¬Ïú²ŠáÛ÷¨˜«ÕçÁÅÎûå³Ç‚˜’ü° À¼âÅ¼")
TXT("œÊ‹Ì”„±›Õ†±Šå‡°")
TXT("†ÎÂ€–õ·ºÌİŠÌì˜Ó•„±§İ°†âî±¨³À˜¾Å™ÛÁ¬ÉÄ˜³³Ü®õ»Æœ£ÄªÒ¦ÛÀèĞ“¹")
TXT("¾¥ŒÒú‚ŒŠ…ì™÷ÕÇ·Ú")
TXT("ùÇÚ´¨Ì˜Õµ•êšš¥ê²ñ¹¥Œ†Šê™Û¤®Æ‰Ğ§ŸÕ§ê³§‰„á–ÂŠ¡£ç£™îÖŠ­ÖŠ¥“³™»")
TXT("İ—öÎŒ¨ï­“™Ù½½ûŞà")
TXT("£î­±ê•ú–Â»÷²¯•ÔŸÀßÕëõ›ÚáÊßÏÒø©“ÛÌ’Æª¨äÄé»Å±·ÈıàÇøú²°Ùê÷Ñï¢ƒ¢Æ")
TXT("¾‡è¹¾µ¥éÌ¯á¤‰")
TXT("‹÷©³âÈô²ö³İÎÛŠ­ò‚ì´µö\377‰íçÑÙš²Ë„ãÑ™ïÍ©Øñ³¸ã²Ó¯Œ×–©±ğ˜¹ÍÉôÜ·ÇùÃ£")
TXT("İîâÇ›°¶»ûíÌŞæØ”˜")
TXT("ì©óöÛ±ï„¥‘ÔÖÍÆº«•—£¹Ôõ˜ÌŒ»¡£â¯ñ®•Ü¹°‘³Ï˜—éìûáÕöËÊ®ÍöŠ×ı÷©´Î¿¨Â")
TXT("®®´úÆ¸™ËÏÃØ±²­«")
TXT("ıÀ½Áôû§á¥Õ÷ÇüôõûÏÖêíşæŸİŞ´Üå¨õÕËŞß¶¨ö×ô²£õ¤ŒŞô†—µï¢ã«Ú‰Ù ‡¿ÃÔá")
TXT("²œµ”®×”á„ú›Ê™œ")
TXT("©Â„Ñ©êÈß£„ö“½€äÜòÀõÛ˜ÊÇÁ¨ÂÆ¬ÈÅ†§ŒÒÊ³ÓÕ¦ıŒŞÔ™‚Ã”ïÊã˜ã®úÖêíÈé¶í")
TXT("„ŸÁ³ŠŒ™œŸ¯ş„Ñ™¾ç")
TXT("©È–ÛØ¬“‰—ìµ‹ºİÆıßÊ¹£¬“¥‡•„Ñ™»ç˜£ò¥úª¶ã©íáşÍâÅ ¶ ’Æ§öª¨ÔŞÁ±ô•ÌÑÆ")
TXT("”³¦šÌ¬–“œÆ§ê÷ÔÇ")
TXT("é€ØÓ†Œıù¢øÚÍ˜½¿ï „´å–½Ø„Æ¡£éŸ•“Ä°Î©çìçºÈûüƒó±ÒŸÜÏÒî–Ô±´‰ƒö°£±")
TXT("•—òÂ–±ó¿ğÚÌÌÂ€ı")
TXT("á”óÍ´âøÆä¯Íæ¡áÀŞòŞÆšô¦ğ²×Î³’°ÑàÀ¥Ü»íÃØëÆƒ¦Û”ÀÂ€£œ·şÓë®Á°†¯")
TXT("ÅşÓ\377Ë áÀ¿±†¿´Ò÷ë")
TXT("ı¦ëÀ¨´¬òøÉ˜à€»ªÚ€ÔÍÂ€È… œ×•ÒŒ å£ßÉİ€€ Â ’†€ÏÂ€‚€âÉ˜€À¼ˆ‰ƒ€ˆ§á€")
TXT("Â€ñ¤Œ€ ™„€Ä“°€")
TXT("€ø’†€Ï‰Â€€âÉ˜€ À¼‰ƒ€ˆ§ˆá€€ñ¤Œ€æ „€Ä“„°€€ø’†€¤ÏÂ€€âÉ€˜€À¼‰ƒ€")
TXT("¡ˆ§á€€ñ¤˜Œ€ „€")
TXT("“Ä“°€€ø’†€ÏÂ€€âÉ˜€À¼‰„ƒ€ˆ§á€€áñ¤Œ€ „Ì€Ä“°€€Àø’†€ÏÂ„€€âÉ˜€À")
TXT("¼‰ƒ€ˆ§á„€€ñ¤Œ€ ")
TXT("³„€Ä“°‚€€ø’†€’ÏÂ€€âÉ˜À€À¼‰ƒ€ˆ§á€€ñ¤ŒÌ€ „€Ä‰“°€€ø’†È€ÏÂ€€â")
TXT("€É˜€À¼‰ƒÂ€ˆ§á€€ñ")
TXT("°¤Œ€ „¦€Ä“°€€ø ’†€ÏÂ€‚€âÉ˜€À¼ˆ‰ƒ€ˆ§á€Â€ñ¤Œ€ ™„€Ä“°€€ø’†€Ï")
TXT("‰Â€€âÉ˜€ À¼‰ƒ€ˆ§")
TXT("ˆá€€ñ¤Œ€æ „€Ä“„°€€ø’†€¤ÏÂ€€âÉ€˜€À¼‰ƒ€¡ˆ§á€€ñ¤˜Œ€ „€“Ä“°€€ø’")
TXT("†€ÏÂ€€âÉ˜€À¼‰")
TXT("„ƒ€ˆ§á€€áñ¤Œ€ „Ì€Ä“°€€Àø’†€ÏÂ„€€âÉ˜€À¼‰ƒ€ˆ§á„€€ñ¤Œ€ ³„€Ä“°")
TXT("‚€€ø’†€’ÏÂ€€âÉ˜")
TXT("À€À¼‰ƒ€ˆ§á€€ñ¤ŒÌ€ „€Ä©“°€€ø—ÖŒ\377öéï½¡ü¤ËÑ€€êñœÉ˜÷îÜÉˆÕ€ ¦ç’")
TXT("£†Ñ‹€ „ùÈ˜€À¼Ë©¥")
TXT("û÷îå®†€şĞ•Åë¯¿¡»Œ€Àíşî¿¦±¬†¿€€€€ÉÅ¤ÎÄ®Âà‚")
TXT("&]")
TXT("[s0;2 &]")
TXT("[s0;Q2 The application is based on the class [* Scribble] derive")
TXT("d from ")
TXT("[* TopWindow]. [* TopWindow ]is the class of main application wi")
TXT("ndows.&]")
TXT("[s0;Q &]")
TXT("[s0;Q2 As we want to sketch, we must define how to store the dra")
TXT("wing. ")
TXT("Scribble stores the drawing as a sequence (vector) of strokes; ")
TXT("each stroke is defined as a vector of points. Let's define it ")
TXT("just like that:&]")
TXT("[s1; &]")
TXT("[s1; Vector< Vector<Point> > image;&]")
TXT("[s0;Q &]")
TXT("[s0;Q2 We have to be able to render the client area (in U`++ we ")
TXT("call ")
TXT("it a [/ view]) of Scribble on system demand. This is accomplishe")
TXT("d ")
TXT("in the Paint method:&]")
TXT("[s0;QR2 &]")
TXT("[s1; void Scribble`::Paint(Draw`& w) {&]")
TXT("[s1; -|Size sz = GetSize();&]")
TXT("[s1; -|w.DrawRect(0, 0, sz.cx, sz.cy, SWhite);&]")
TXT("[s1; -|for(int i = 0; i < image.GetCount(); i`++) {&]")
TXT("[s1; -|-|Point p1 = image`[i`]`[0`];&]")
TXT("[s1; -|-|for(int j = 1; j < image`[i`].GetCount(); j`++) {&]")
TXT("[s1; -|-|-|Point p2 = image`[i`]`[j`];&]")
TXT("[s1; -|-|-|w.DrawLine(p1, p2);&]")
TXT("[s1; -|-|-|p1 = p2;&]")
TXT("[s1; -|-|}&]")
TXT("[s1; -|-|w.DrawRect(p1.x, p1.y, 1, 1, SBlack);&]")
TXT("[s1; -|}&]")
TXT("[s1; }&]")
TXT("[s1; &]")
TXT("[s0;Q2 The routine queries the actual size of the view within th")
TXT("e ")
TXT("window (as the user can change the window size at runtime) and ")
TXT("erases it with white. Then starts a loop in variable [/ i] walki")
TXT("ng ")
TXT("through the strokes and an inner loop walking vertices in each ")
TXT("stroke using variable [/ j] and drawing the actual lines.&]")
TXT("[s0;Q &]")
TXT("[s0;Q2 Now that we can display our drawing in the window, we sho")
TXT("uld ")
TXT("consider user input for the actual sketching. We shall have to ")
TXT("respond to mouse clicks and mouse moves. This is handled by the ")
TXT("respective methods [* LeftDown] and [* MouseMove]:&]")
TXT("[s0;Q &]")
TXT("[s1; void Scribble`::LeftDown(Point p, dword keyflags) {&]")
TXT("[s1; -|image.Add().Add() = p;&]")
TXT("[s1; -|SetCapture();&]")
TXT("[s1; -|Refresh();&]")
TXT("[s1; }&]")
TXT("[s1; &]")
TXT("[s0;Q2 LeftDown creates a new stroke and inserts to it the start")
TXT("ing ")
TXT("point of the new stroke (the position within the view where the ")
TXT("mouse click has taken place). The somewhat cryptic line \"[/ imag")
TXT("e.Add().Add() ")
TXT("= p]\" could be expanded to the more understandable form:&]")
TXT("[s0;Q &]")
TXT("[s1; // Add a new vector of points at the end of image&]")
TXT("[s1; Vector<Point>`& newstroke = image.Add();&]")
TXT("[s1; &]")
TXT("[s1; // Add a new Point at the end of stroke and assign it the n")
TXT("ew ")
TXT("point&]")
TXT("[s1; newstroke.Add() = p; &]")
TXT("[s1; &]")
TXT("[s0;2 LeftDown then sets up mouse capture for the window (SetCap")
TXT("ture) ")
TXT("and forces the view area to be repainted (Refresh).&]")
TXT("[s0;2 &]")
TXT("[s0;2 When the user drags the mouse while holding down the left ")
TXT("button ")
TXT("(which means the mouse capture is still active), we add more ")
TXT("points to the current stroke and refresh the view area:&]")
TXT("[s0;2 &]")
TXT("[s1; void Scribble`::MouseMove(Point p, dword keyflags) {&]")
TXT("[s1; -|if(HasCapture()) {&]")
TXT("[s1; -|-|image.Top().Add() = p;&]")
TXT("[s1; -|-|Refresh();&]")
TXT("[s1; -|}&]")
TXT("[s1; }&]")
TXT("[s1; &]")
TXT("[s0;Q2 We obtain the reference to the last stroke by calling the")
TXT(" ")
TXT("[/ Top()] method, which returns the reference to the last item ")
TXT("of the image. Using [/ Add()] we create another point and we ass")
TXT("ign ")
TXT("to it the new point [/ p].&]")
TXT("[s0;Q &]")
TXT("[s0;Q/2 [/ So much for user interaction for the moment. As QLIB ")
TXT("revokes ")
TXT("mouse capture whenever all mouse buttons are released, we do ")
TXT("not have to handle ]LeftUp.&]")
TXT("[s0;Q &]")
TXT("[s0;Q2 We will use Scribble constructor to define the appearance")
TXT(" ")
TXT("of the [* TopWindow]:&]")
TXT("[s0;Q &]")
TXT("[s1; Scribble`::Scribble() {&]")
TXT("[s1; -|Title(\"Scribble\").Zoomable().Sizeable();&]")
TXT("[s1; -|AddFrame(InsetFrame);&]")
TXT("[s1; -|BackPaint();&]")
TXT("[s1; }&]")
TXT("[s1; &]")
TXT("[s0;b100;Q2 [/ Title] sets the window caption (and returns refer")
TXT("ence ")
TXT("to the same [* TopWindow] as is usual for such \"[/ modifiers]\" i")
TXT("n ")
TXT("U`++), [/ Zoomable] adds minimize and maximize boxes to the [* T")
TXT("opWindow] ")
TXT("and [/ Sizeable] makes it resizable by dragging its borders. [/ ")
TXT("AddFrame ")
TXT("(InsetFrame)] adds a nice inset border around the view area (Fra")
TXT("mes ")
TXT("will be discussed in depth in a further step of Scribble tutoria")
TXT("l). ")
TXT("[/ BackPaint][*/  ]ensures flicker-free operation, as everything")
TXT(" ")
TXT("is painted into back plane first.&]")
TXT("[s0;Q &]")
TXT("[s0;Q2 All we have to do now is to run the window (in a modal lo")
TXT("op):&]")
TXT("[s0;Q &]")
TXT("[s1; Scribble().Run();&]")
TXT("[s0;Q &]")
TXT("[s0;Q/R2 Complete application source&]")
TXT("[s1; &]")
TXT("[s1;+59 #include <CtrlLib/CtrlLib.h>&]")
TXT("[s1;+59 &]")
TXT("[s1;+59 class Scribble : public TopWindow {&]")
TXT("[s1;+59 public:&]")
TXT("[s1;+59 -|virtual void   Paint(Draw`& w);&]")
TXT("[s1;+59 -|virtual void   MouseMove(Point p, dword keyflags);&]")
TXT("[s1;+59 -|virtual void   LeftDown(Point p, dword keyflags);&]")
TXT("[s1;+59 &]")
TXT("[s1;+59 protected:&]")
TXT("[s1;+59 -|Vector< Vector<Point> > image;&]")
TXT("[s1;+59 &]")
TXT("[s1;+59 public:&]")
TXT("[s1;+59 -|Scribble();&]")
TXT("[s1;+59 };&]")
TXT("[s1;+59 &]")
TXT("[s1;+59 void Scribble`::Paint(Draw`& w)&]")
TXT("[s1;+59 {&]")
TXT("[s1;+59 -|Size sz = GetSize();&]")
TXT("[s1;+59 -|w.DrawRect(0, 0, sz.cx, sz.cy, SWhite);&]")
TXT("[s1;+59 -|for(int i = 0; i < image.GetCount(); i`++) {&]")
TXT("[s1;+59 -|-|const Vector<Point>`& stroke = image`[i`];&]")
TXT("[s1;+59 -|-|Point p1 = stroke`[0`];&]")
TXT("[s1;+59 -|-|for(int j = 1; j < stroke.GetCount(); j`++) {&]")
TXT("[s1;+59 -|-|-|Point p2 = stroke`[j`];&]")
TXT("[s1;+59 -|-|-|w.DrawLine(p1, p2);&]")
TXT("[s1;+59 -|-|-|p1 = p2;&]")
TXT("[s1;+59 -|-|}&]")
TXT("[s1;+59 -|-|w.DrawRect(p1.x, p1.y, 1, 1, SBlack);&]")
TXT("[s1;+59 -|}&]")
TXT("[s1;+59 }&]")
TXT("[s1;+59 &]")
TXT("[s1;+59 void Scribble`::MouseMove(Point p, dword keyflags)&]")
TXT("[s1;+59 {&]")
TXT("[s1;+59 -|if(HasCapture()) {&]")
TXT("[s1;+59 -|-|image.Top().Add() = p;&]")
TXT("[s1;+59 -|-|Refresh();&]")
TXT("[s1;+59 -|}&]")
TXT("[s1;+59 }&]")
TXT("[s1;+59 &]")
TXT("[s1;+59 void Scribble`::LeftDown(Point p, dword keyflags)&]")
TXT("[s1;+59 {&]")
TXT("[s1;+59 -|image.Add().Add() = p;&]")
TXT("[s1;+59 -|SetCapture();&]")
TXT("[s1;+59 -|Refresh();&]")
TXT("[s1;+59 }&]")
TXT("[s1;+59 &]")
TXT("[s1;+59 Scribble`::Scribble()&]")
TXT("[s1;+59 {&]")
TXT("[s1;+59 -|Title(\"Scribble\").Zoomable().Sizeable();&]")
TXT("[s1;+59 -|AddFrame(InsetFrame());&]")
TXT("[s1;+59 -|BackPaint();&]")
TXT("[s1;+59 }&]")
TXT("[s1;+59 &]")
TXT("[s1;+59 void AppMain()&]")
TXT("[s1;+59 {&]")
TXT("[s1;+59 -|Scribble().Run();&]")
TXT("[s1;+59 }&]")
TXT("[s1;+59 ")
END_ITEM
